!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["@discord-bot-creator/bot"]=t():e["@discord-bot-creator/bot"]=t()}(global,(function(){return function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(o,i,function(t){return e[t]}.bind(null,i));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("chalk")},function(e,t,n){"use strict";
/*!
 * Copyright (c) Discord Bot Creator.
 *
 * This source code is licensed under the GPL-3.0.
 */Object.defineProperty(t,"__esModule",{value:!0});const o=n(0),i=new(n(3).default)(JSON.parse(o.readFileSync("./storage.json","utf-8")));(process.mainModule.filename.endsWith("bot")||process.mainModule.filename.endsWith("bot.js")||process.mainModule.filename.endsWith("index.ts"))&&i.start(),t.default=i},function(module,exports,__webpack_require__){"use strict";(function(__dirname){Object.defineProperty(exports,"__esModule",{value:!0});const Discord=__webpack_require__(4),fs=__webpack_require__(0),chalk=__webpack_require__(1),path=__webpack_require__(5),node_fetch_1=__webpack_require__(6),actions_1=__webpack_require__(7),utils=__webpack_require__(13);class DBCBot{constructor(e){e.config.intents||(e.config.intents=[],e.config.intents.push("GUILDS"),e.config.intents.push("GUILD_MESSAGES"),fs.writeFileSync("./storage.json",JSON.stringify(e,null,2),"utf-8")),e.config.intents.includes("GUILDS")||(e.config.intents.push("GUILDS"),fs.writeFileSync("./storage.json",JSON.stringify(e,null,2),"utf-8")),e.config.intents.includes("GUILD_MESSAGES")||(e.config.intents.push("GUILD_MESSAGES"),fs.writeFileSync("./storage.json",JSON.stringify(e,null,2),"utf-8")),this.storage=e,this.client=new Discord.Client({ws:{intents:this.storage.config.intents}}),this.globalVariables=new Map}get actions(){return actions_1.default}get utils(){return utils}get version(){return JSON.parse(fs.readFileSync("./package.json","utf-8")).version}async checkForUpdates(){if(!fs.existsSync(path.join(__dirname,"index.ts"))){this.utils.log("info","Checking if your bot is up to date...");try{const e=await(await node_fetch_1.default("https://raw.githubusercontent.com/discord-bot-creator/bot/master/dist/package.json")).json();if(this.version!==e.version){this.utils.log("alert","Your bot is not up to date, updating...");try{const t=await(await node_fetch_1.default("https://raw.githubusercontent.com/discord-bot-creator/bot/master/dist/bot.js")).text();fs.writeFileSync("./package.json",JSON.stringify(e,null,2),"utf-8"),fs.writeFileSync("./bot.js",t,"utf-8"),this.utils.log("success","Bot updated! Start your bot again.",!0)}catch(e){switch(e.code){case"ENOTFOUND":this.utils.log("error","Not was possible install the update, check your internet connection!",!0);break;default:this.utils.log("error","Unknown error: "+e,!0)}}}this.utils.log("info","Your bot is up to date.")}catch(e){switch(e.code){case"ENOTFOUND":this.utils.log("error","Not was possible check if your bot is up to date, check your internet connection!",!0);break;default:this.utils.log("error","Unknown error: "+e,!0)}}}}async setupEvents(){this.client.on("ready",()=>this.utils.log("success","Bot started!")),this.client.on("message",message=>{if(message.content.startsWith(this.storage.config.prefix)||!message.author.bot){const commandArgs=message.content.slice(this.storage.config.prefix.length).split(/ +/),commandName=this.storage.config.caseSensitive?commandArgs.shift().toLowerCase():commandArgs.shift(),command=this.storage.commands.find(e=>e.name===commandName)||this.storage.commands.find(e=>e.aliases.includes(commandName));if(command){const actions=this.actions,action=actions.find(e=>e.name===command.actions[0].name),log=this.utils.log,variables=new Map,globalVariables=this.globalVariables;if(action.intents&&!this.storage.config.intents.includes(action.intents))return log("error","Your bot config does not have the following intents to use some actions: "+action.intents.join(", "));function getField(index,id){const field=command.actions[index].fields.find(e=>e.id===id);if(field){const result=eval(`\n              function variable(name) {\n                return variables.get(name) || \n                globalVariables.get(name);\n              }\n              const command = message;\n              ${"`"+field.value+"`"}\n            `);return result}}function throwActionError(e,t){log("error",`Ocurred on command ${commandName} on action ${e}: ${t}`,!0)}function goToAction(e){e.index++,command.actions[e.index]&&actions.find(t=>t.name===command.actions[e.index].name).run(e)}const cache={client:this.client,message:message,index:0,variables:variables,globalVariables:globalVariables,getField:getField,throwActionError:throwActionError,goToAction:goToAction};action.run(cache)}}});for(const event of this.storage.events)this.client.on(event.type,(output0,output1)=>{const variables=new Map,globalVariables=this.globalVariables;if(event.outputs){let e=0;for(const t of event.outputs)output1&&1===e?variables.set(t,output1):variables.set(t,output0),e++}const actions=this.actions,action=actions.find(e=>e.name===event.actions[0].name),log=this.utils.log;function getField(index,id){const field=event.actions[index].fields.find(e=>e.id===id);if(field){const result=eval(`\n              function variable(name) {\n                return variables.get(name) || \n                globalVariables.get(name);\n              }\n              const command = message;\n              ${"`"+field.value+"`"}\n            `);return result}}function throwActionError(e,t){log("error",`Ocurred on event ${event.name} on action ${e}: ${t}`,!0)}function goToAction(e){e.index++,event.actions[e.index]&&actions.find(t=>t.name===event.actions[e.index].name).run(e)}const cache={index:0,variables:variables,globalVariables:globalVariables,getField:getField,throwActionError:throwActionError,client:this.client,goToAction:goToAction};action.run(cache)})}async start(){if(console.log(`\n  ${chalk.magenta("Discord Bot Creator")} Bot ${chalk.gray("v"+this.version)}\n__________________________________\n`),process.argv.includes("--test"))return this.utils.log("success","Everything ok.",!0);await this.checkForUpdates(),await this.setupEvents(),this.utils.log("info","Starting bot..."),this.client.login(this.storage.config.token).catch(e=>{switch(e.code){case"TOKEN_INVALID":this.utils.log("error","You placed an invalid token in your bot config.",!0);break;default:this.utils.log("error","Unknown error: "+e,!0)}})}}exports.default=DBCBot}).call(this,"/")},function(e,t){e.exports=require("discord.js")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("node-fetch")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(8),i=n(9),s=n(10),r=n(11),a=n(12),c=[o.default,i.default,s.default,r.default,a.default];t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=new class{get name(){return"Send Message"}get description(){return"Send messages to channels and users."}get category(){return"Client/Messages"}get display(){return{column:[{field:{type:"message-select",id:"send-to",label:"Send To"}},{field:{type:"textarea",id:"message",label:"Message"}}]}}async run(e){const t=e.getField(e.index,"send-to"),n=e.getField(e.index,"variable-name"),o=e.getField(e.index,"message");try{switch(t){case"command-channel":await e.message.channel.send(o);break;case"command-author":await e.message.author.send(o);break;case"variable":await e.variables.get(n).send(o);break;case"global-variable":await e.globalVariables.get(n).send(o)}e.goToAction(e)}catch(t){e.throwActionError(e.index,t)}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=new class{get name(){return"Jump to Action"}get description(){return"Jump to any selected action number, if exists."}get category(){return"Actions"}get display(){return{field:{type:"number",id:"action-to-jump",label:"Action to Jump"}}}run(e){const t=Number(e.getField(e.index,"action-to-jump"));e.index=t,e.goToAction(e)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=new class{get name(){return"Skip Actions"}get description(){return"Skip a sequence of actions according with the amount."}get category(){return"Actions"}get display(){return{field:{type:"number",id:"amount-to-skip",label:"Amount to Skip"}}}run(e){const t=Number(e.getField(e.index,"amount-to-skip"));e.index+=t,e.goToAction(e)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=new class{get name(){return"Stop Actions"}get description(){return"Stop the actions sequence."}get category(){return"Actions"}get display(){return{}}run(){}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=new class{get name(){return"Create Variable"}get description(){return"Create custom variables."}get category(){return"Variables"}get display(){return{column:[{field:{type:"select",id:"variable-type",label:"Type",options:["Text","Number","Object","List","True/false"]}},{field:{type:"textarea",id:"variable-value",label:"Value"}},{field:{type:"variable-select",id:"variable-store-in",label:"Store in"}}]}}run(e){const t=e.getField(e.index,"variable-type");let n=e.getField(e.index,"variable-value");const o=e.getField(e.index,"variable-store-in"),i=e.getField(e.index,"variable-name");switch(t){case"text":n=String(n);break;case"number":n=Number(n);break;case"object":n=Object(n);break;case"list":n=Array(n);break;case"true-false":n=Boolean(n)}"temp"===o?e.variables.set(i,n):e.globalVariables.set(i,n),e.goToAction(e)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.log=void 0;const o=n(14);t.log=o.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(1);t.default=function(e,t,n){const i=new Date,s=`${i.getMonth()}/${i.getDate()}/${i.getFullYear()} - ${i.getHours()}:${i.getMinutes()}:${i.getSeconds()}`;switch(e){case"info":console.log(`${o.gray("["+s+"]")} ${o.blue("info")} ${t}`);break;case"success":console.log(`${o.gray("["+s+"]")} ${o.green("success")} ${t}`);break;case"error":console.error(`${o.gray("["+s+"]")} ${o.red("error")} ${t}`);break;case"alert":console.log(`${o.gray("["+s+"]")} ${o.yellow("alert")} ${t}`)}n&&process.exit()}}])}));